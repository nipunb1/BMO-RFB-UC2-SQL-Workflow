<div class="admin">
  <div class="admin-header">
    <h1>System Administration</h1>
    <p>Manage users, monitor system performance, and review audit logs</p>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'users'"
      (click)="setActiveTab('users')">
      Users
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'system'"
      (click)="setActiveTab('system')">
      System Stats
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'audit'"
      (click)="setActiveTab('audit')">
      Audit Logs
    </button>
  </div>

  <!-- Users Tab -->
  <div class="tab-content" *ngIf="activeTab === 'users'">
    <!-- Add New User -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Add New User</h2>
      </div>
      
      <form (ngSubmit)="createUser()" #userForm="ngForm">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Name *</label>
            <input type="text" class="form-input" [(ngModel)]="newUser.name" name="name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" class="form-input" [(ngModel)]="newUser.email" name="email" required>
          </div>
          <div class="form-group">
            <label class="form-label">Role *</label>
            <select class="form-select" [(ngModel)]="newUser.role" name="role" required>
              <option value="DEVELOPER">Developer</option>
              <option value="SENIOR_DEVELOPER">Senior Developer</option>
              <option value="MANAGER">Manager</option>
              <option value="ADMIN">Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Status *</label>
            <select class="form-select" [(ngModel)]="newUser.status" name="status" required>
              <option value="ACTIVE">Active</option>
              <option value="INACTIVE">Inactive</option>
            </select>
          </div>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="!userForm.form.valid">
            Add User
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetNewUser()">
            Reset
          </button>
        </div>
      </form>
    </div>

    <!-- Users List -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">User Management</h2>
      </div>
      
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Status</th>
              <th>Last Login</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>#{{ user.id }}</td>
              <td>{{ user.name }}</td>
              <td>{{ user.email }}</td>
              <td>
                <select class="form-select-sm" [value]="user.role" (change)="updateUserRole(user.id, $any($event.target).value)">
                  <option value="DEVELOPER">Developer</option>
                  <option value="SENIOR_DEVELOPER">Senior Developer</option>
                  <option value="MANAGER">Manager</option>
                  <option value="ADMIN">Admin</option>
                </select>
              </td>
              <td>
                <select class="form-select-sm" [value]="user.status" (change)="updateUserStatus(user.id, $any($event.target).value)">
                  <option value="ACTIVE">Active</option>
                  <option value="INACTIVE">Inactive</option>
                  <option value="SUSPENDED">Suspended</option>
                </select>
              </td>
              <td>{{ formatDate(user.lastLogin) }}</td>
              <td>
                <button class="btn btn-sm btn-danger" (click)="deleteUser(user.id)">
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- System Stats Tab -->
  <div class="tab-content" *ngIf="activeTab === 'system'">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number">{{ systemStats.totalUsers }}</div>
        <div class="stat-label">Total Users</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ systemStats.activeUsers }}</div>
        <div class="stat-label">Active Users</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ systemStats.totalRequests }}</div>
        <div class="stat-label">Total Requests</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ systemStats.completedRequests }}</div>
        <div class="stat-label">Completed</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ systemStats.pendingApprovals }}</div>
        <div class="stat-label">Pending Approvals</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ systemStats.systemUptime }}</div>
        <div class="stat-label">System Uptime</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ systemStats.avgProcessingTime }}</div>
        <div class="stat-label">Avg Processing Time</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ systemStats.successRate }}</div>
        <div class="stat-label">Success Rate</div>
      </div>
    </div>
  </div>

  <!-- Audit Logs Tab -->
  <div class="tab-content" *ngIf="activeTab === 'audit'">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Audit Trail</h2>
      </div>
      
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Action</th>
              <th>User</th>
              <th>Details</th>
              <th>Timestamp</th>
              <th>IP Address</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of auditLogs">
              <td>#{{ log.id }}</td>
              <td>
                <span class="action-badge">{{ log.action.replace('_', ' ') }}</span>
              </td>
              <td>{{ log.user }}</td>
              <td>{{ log.details }}</td>
              <td>{{ formatDate(log.timestamp) }}</td>
              <td>{{ log.ipAddress }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
